<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Impression à Distance</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container mt-5" style="max-width: 700px;">
        <div class="mb-4"><a href="https://www.latelier.app" class="btn btn-outline-secondary btn-sm"><i class="bi bi-arrow-left"></i> Retour au site</a></div>
        <div class="card">
            <div class="card-body">
                <h1 class="card-title text-center mb-4">Service d'Impression</h1>
                {% if error_message %}<div class="alert alert-danger">{{ error_message }}</div>{% endif %}
                {% if success_message %}<div class="alert alert-success">{{ success_message }}</div>{% endif %}
                <form id="print-form">
                    <div class="mb-3">
                        <label for="client_name" class="form-label">Votre Nom</label>
                        <input type="text" class="form-control" id="client_name" name="client_name" required>
                    </div>
                    <input type="file" id="file-input" multiple class="d-none">
                    <div class="d-grid mb-3"><button type="button" class="btn btn-custom-secondary" id="add-file-button"><i class="bi bi-plus-circle-dotted"></i> Ajouter des fichiers</button></div>
                    <div id="file-options-area" class="d-none"><hr><p class="fw-bold">Fichiers à imprimer :</p><ul class="list-group" id="file-list-container"></ul><hr></div>
                    <div class="alert alert-info small mt-3"><strong>N&B :</strong> {{ "%.2f"|format(prix_nb) }} € | <strong>Couleur :</strong> {{ "%.2f"|format(prix_c) }} €</div>
                    <div class="d-grid mt-4"><button type="submit" class="btn btn-custom-submit">Calculer le Prix</button></div>
                </form>
                <div class="text-center mt-3"><a href="{{ url_for('login') }}" class="text-muted small">Espace Commerçant</a></div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="confirmModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered modal-lg"><div class="modal-content">
        <div class="modal-header border-0"><h5 class="modal-title">Résumé de l'impression</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">
            <p class="text-center text-muted mb-4">Pour : <strong id="modal-client-name" class="text-dark"></strong></p>
            <div id="modal-task-list"></div>
            <div class="d-flex justify-content-between align-items-center bg-dark text-white p-3 rounded mt-3">
                <strong class="fs-5">PRIX TOTAL</strong><strong id="modal-total-price" class="fs-4"></strong>
            </div>
        </div>
        <div class="modal-footer border-0">
            <button type="button" class="btn btn-custom-secondary" data-bs-dismiss="modal">Modifier</button>
            <form id="modal-print-form" action="/print" method="post" class="m-0 d-grid" onsubmit="showLoadingScreen()">
                <button id="print-button" type="submit" class="btn btn-custom-submit">Imprimer</button>
            </form>
        </div>
    </div></div></div>
    <div id="loading-overlay"><div class="spinner-border"></div><h2 class="mt-3">Impression en cours...</h2><p class="text-muted">Veuillez patienter.</p></div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>function showLoadingScreen() { const m = bootstrap.Modal.getInstance(document.getElementById('confirmModal')); if(m) m.hide(); document.getElementById('loading-overlay').style.display = 'flex'; }</script>
</body>
</html>
